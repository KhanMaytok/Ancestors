NAMESPACE = ACS

########################
## TIAMAT EVENT CHAIN ##
########################
# ACS.00001 - Tiamat comet in the sky
narrative_event = {
	id = ACS.00001
	title = ACS_00001_TITLE
	desc = ACS_00001_DESC
	is_triggered_only = yes
	ai = no
	picture = GFX_evt_tiamat

	trigger = {
		NOT = { has_global_flag = comet_tiamat }
	}

	immediate = {
		ROOT = {
			save_event_target_as = its_me_mamma
		}
	}

	option = {
		trigger = {
			OR = {
				multiplayer = no
				AND = {
					multiplayer = yes
					is_multiplayer_host_character = yes
				}
			}
		}
		name = ACS_00001_OPT_A				
		character_event = { id = ACS.00003 days = 32 } # Player is notified about Tiamat devastation
		narrative_event = { id = ACS.00004 days = 45 } # Spawn Senua, Olaf and Tilda and parents
		set_global_flag = comet_tiamat
		hidden_tooltip = {
			set_variable = { which = provs value = 5 }
			while = {
				limit = {
					check_variable = {
						which = provs
						value = 1
					}
				}
				subtract_variable = {
					which = provs
					value = 1
				}
				random_province = {
					limit = {
						not = { owner = { character = ROOT } }
						is_land =  yes
					}
					province_event = { id = ACS.00002 days = 30 }
				}
			}
		}
	}
}

# ACS.00002 - Tiamat comet causes devastation
province_event = {
	id = ACS.00002
	hide_window = yes
	is_triggered_only = yes

	immediate = { # burn it all
		add_province_modifier = { name = devastated_by_tiamat years = 20 }
		spawn_disease = tuberculosis
		any_province_character = {
			death = { death_reason = death_murder_unknown_combustion }
		}
		any_province_holding = {
			destroy_settlement = yes
		}
		any_neighbor_province = {
			limit = {
				is_land = yes
			}
			spawn_disease = tuberculosis
		}
	}
}

# ACS.00003 - Player is notified about Tiamat devastation
character_event = {
	id = ACS.00003
	desc = ACS_00003_DESC
	picture = GFX_evt_emissary_byzantine
	is_triggered_only = yes

	option = {
		name = OK
	}
}

#####################
## THE SPAWN EVENT ##
#####################
# ACS.00004 - Spawn Senua, Olaf and Tilda and parents
narrative_event = {
	id = ACS.00004
	title = ACS_00004_TITLE
	desc = ACS_00004_DESC
	picture = GFX_evt_courtiers_talking
	is_triggered_only = yes

	immediate = {
		create_character = {
			name = Olaf
			age = 33
			culture = greek
			religion = FROM
			trait = cruel
			trait = ambitious
			trait = elusive_shadow
			trait = scarred_high
			trait = bastard
			trait = shrewd
			trait = genius
			trait = hunter
			trait = diligent
			trait = lustful
			trait = prevent_marriage
			trait = robust
			trait = strategist
			trait = socializer
			trait = hedonist
			health = 10
			dna = dhhhhjfcabh
		}
		new_character = {
			set_character_flag = is_olaf
			set_character_flag = originated_from_chinese_court
			join_society = pentaghast_society
			set_society_grandmaster = yes
			dynasty = 300001
			save_event_target_as = olaf_the_killer
			character_event = { id = ACS.00005 } # Spawn pentaghast society characters
			character_event = { id = ACS.00006 days = 60 } # Moves to the mercenary band
		}
		create_character = {
			name = Tilda
			female = yes
			age = 41
			culture = scottish
			religion = buddhist
			trait = mystic
			trait = prevent_marriage
			trait = quick
			trait = strong
			trait = shrewd
			health = 10
		}
		new_character = {
			set_character_flag = is_ancient_one
			join_society = sakya_society
			set_society_grandmaster = yes 
			set_character_flag = originated_from_chinese_court
			culture = khazar
			dynasty = 300000
			character_event = { id = ACS.00006 } # Moves to the mercenary band
		}
		create_character = {
			name = Senua # The first Vee
			dna = qqovluyitrm
			female = yes
			age = 18
			culture = pictish
			religion = FROM
			trait = fair
			trait = strong
			trait = mystic
			trait = wroth
			trait = sharingan
			trait = syrena
			trait = kind
			trait = lustful
			trait = diligent
			trait = proud
			trait = prevent_marriage
			trait = vee_blood
		}
		new_character = {
			set_character_flag = is_vee
			dynasty = 300001
			join_society = pentaghast_society
			
			narrative_event = { id = ACS.00009 days = 15 } # Born of Khalga
			character_event = { id = ACS.00031 days = 62 } # Vee deletes competence
			save_event_target_as = vee
		}
		event_target:its_me_mamma = {
			add_lover = event_target:vee
		}
	}

	option = {
		name = ACS_00004_OPT_A
	}
}

# ACS.00005 - Spawn secondary members of the Pentaghast Society
character_event = {
	id = ACS.00005
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		# OLAF RELATIONS
        if = {
            limit = {
                has_character_flag = is_olaf
            }
            create_character = {
                name = "Ragnarr"
                age = 60
                culture = greek
                religion = ishtar_religion
                trait = ambitious
                trait = shrewd
                trait = physician
                trait = diligent
                trait = lustful
                trait = grey_eminence
                trait = administrator
                health = 20
                dynasty = 300001
            }
            new_character = {
                save_event_target_as = olaf_father
            }
            create_character = {
                age = 55
                female = yes
                culture = greek
                religion = ishtar_religion
                trait = fair
                trait = genius
                trait = shrewd
                trait = physician
                trait = diligent
                trait = midas_touched
                trait = administrator
                health = 20
                dynasty = none
            }
            new_character = {
                save_event_target_as = olaf_mother
            }
            create_character = {
                age = 30
                culture = greek
                religion = ishtar_religion
                trait = fair
                trait = genius
                trait = shrewd
                trait = physician
                trait = diligent
                trait = midas_touched
                trait = administrator
                health = 20
                dynasty = 300001
            }
            new_character = {
                set_mother = event_target:olaf_mother
                set_father = event_target:olaf_father
                save_event_target_as = olaf_brother
            }

            event_target:olaf_the_killer = {
                set_mother = event_target:olaf_mother
                set_father = event_target:olaf_father
            }

			# Olaf purgues his family
            event_target:olaf_father = {
                death = { death_reason = death_murder killer = event_target:olaf_the_killer }
            }
            event_target:olaf_mother = {
                death = { death_reason = death_murder killer = event_target:olaf_the_killer }
            }
            event_target:olaf_brother = {
                death = { death_reason = death_murder killer = event_target:olaf_the_killer }
            }

			# Olaf sisters
            create_character = {
                name="Gunnr"
                trait = ambitious
                trait = fair
                trait = genius
			    trait = elusive_shadow
                trait = prevent_marriage
                trait = seductress
                female = yes
                culture = greek
                religion = FROM
                health = 20
            }
            new_character = {
                join_society = pentaghast_society
                society_rank_up = 3
                set_character_flag = originated_from_chinese_court
                set_father = event_target:olaf_father
				set_mother = event_target:olaf_mother
                dynasty = 300001
                character_event = { id = ACS.00201 }
            }
            create_character = {
                name="Geirdriful"
                trait = ambitious
                trait = fair
                trait = genius
			    trait = elusive_shadow
                trait = prevent_marriage
                trait = seductress
                female = yes
                culture = greek
                religion = FROM
                health = 20
            }
            new_character = {
                join_society = pentaghast_society
                society_rank_up = 3
                set_character_flag = originated_from_chinese_court
                set_father = event_target:olaf_father
                dynasty = 300001
                set_mother = event_target:olaf_mother
                character_event = { id = ACS.00201 }
            }
            create_character = {
                name="Eir"
                trait = ambitious
                trait = fair
                trait = genius
			    trait = elusive_shadow
                trait = prevent_marriage
                trait = seductress
                female = yes
                culture = greek
                religion = FROM
                health = 20
            }
            new_character = {
                join_society = pentaghast_society
                society_rank_up = 3
                set_character_flag = originated_from_chinese_court
                set_father = event_target:olaf_father
                dynasty = 300001
                set_mother = event_target:olaf_mother
                character_event = { id = ACS.00201 }
            }
            create_character = {
                name="Kara"
                trait = ambitious
                trait = fair
                trait = genius
			    trait = elusive_shadow
                trait = prevent_marriage
                trait = seductress
                female = yes
                culture = greek
                religion = FROM
                health = 20
            }
            new_character = {
                join_society = pentaghast_society
                society_rank_up = 3
                set_character_flag = originated_from_chinese_court
                set_father = event_target:olaf_father
                dynasty = 300001
                set_mother = event_target:olaf_mother
                character_event = { id = ACS.00201 }
            }
            create_character = {
                name="Rota"
                trait = ambitious
                trait = fair
                trait = genius
			    trait = elusive_shadow
                trait = prevent_marriage
                trait = seductress
                female = yes
                culture = greek
                religion = FROM
                health = 20
            }
            new_character = {
                join_society = pentaghast_society
                society_rank_up = 3
                set_character_flag = originated_from_chinese_court
                set_father = event_target:olaf_father
                dynasty = 300001
                set_mother = event_target:olaf_mother
                character_event = { id = ACS.00201 }
            }
            create_character = {
                name="Olrun"
                trait = ambitious
                trait = fair
                trait = genius
			    trait = elusive_shadow
                trait = prevent_marriage
                trait = seductress
                female = yes
                culture = greek
                religion = FROM
                health = 20
            }
            new_character = {
                join_society = pentaghast_society
                society_rank_up = 3
                set_character_flag = originated_from_chinese_court
                set_father = event_target:olaf_father
                dynasty = 300001
                set_mother = event_target:olaf_mother
                character_event = { id = ACS.00201 }
            }
            create_character = {
                name="Gondul"
                trait = ambitious
                trait = fair
                trait = genius
			    trait = elusive_shadow
                trait = prevent_marriage
                trait = seductress
                female = yes
                culture = greek
                religion = FROM
                health = 20
            }
            new_character = {
                join_society = pentaghast_society
                society_rank_up = 3
                set_character_flag = originated_from_chinese_court
                set_father = event_target:olaf_father
                dynasty = 300001
                set_mother = event_target:olaf_mother
                character_event = { id = ACS.00201 }
            }
            create_character = {
                name="Hildr"
                trait = ambitious
                trait = fair
                trait = genius
			    trait = elusive_shadow
                trait = prevent_marriage
                trait = seductress
                female = yes
                culture = greek
                religion = FROM
                health = 20
            }
            new_character = {
                join_society = pentaghast_society
                society_rank_up = 3
                set_character_flag = originated_from_chinese_court
                set_father = event_target:olaf_father
                dynasty = 300001
                set_mother = event_target:olaf_mother
                character_event = { id = ACS.00201 }
            }
            create_character = {
                name="Sigrun"
                trait = ambitious
                trait = fair
                trait = genius
			    trait = elusive_shadow
                trait = prevent_marriage
                trait = seductress
                female = yes
                culture = greek
                religion = FROM
                health = 20
            }
            new_character = {
                join_society = pentaghast_society
                society_rank_up = 3
                set_character_flag = originated_from_chinese_court
                set_father = event_target:olaf_father
                dynasty = 300001
                set_mother = event_target:olaf_mother
                character_event = { id = ACS.00201 }
            }
        }
    }
}

# ACS.00006 - Find the current leader of the Pentaghast and Sakya mercenary band
character_event = {
	id = ACS.00006
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				ROOT = {
					OR = {
						has_character_flag = is_ancient_one
						has_character_flag = is_khalga
					}
				}
			}
			random_character = {
				limit = { has_landed_title = d_mercenary_sakya }
				character_event = { id = ACS.00007 }				
			}
			break = yes
		}
		if = {
			limit = {
				ROOT = {
					OR = {
						has_character_flag = is_olaf
						has_character_flag = is_vee
					}
				}
			}
			random_character = {
				limit = { has_landed_title = d_mercenary_pentaghast }
				character_event = { id = ACS.00007 }				
			}
			break = yes
		}
	}
}

# ACS.00007 - Pentaghast-Sakya leader receives Olaf-Tilda/Vee-Khalga
character_event = {
	id = ACS.00007
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		if = {
			limit = {
				FROM = {
					has_character_flag = is_ancient_one
				}
			}
			FROM = {
				move_character = ROOT
				remove_trait = prevent_marriage
				d_mercenary_sakya = {
					grant_title = PREV
					set_defacto_liege = THIS
				}
				c_mercenary_sakya = {
					grant_title = PREV
					set_defacto_liege = THIS
				}					
			}
			break = yes
		}
		if = {
			limit = {
				FROM = {
					has_character_flag = is_olaf
				}
			}
			FROM = {
				move_character = ROOT
				remove_trait = prevent_marriage
				d_mercenary_pentaghast = {
					grant_title = PREV
					set_defacto_liege = THIS
				}
				c_mercenary_pentaghast = {
					grant_title = PREV
					set_defacto_liege = THIS
				}					
			}
			event_target:its_me_mamma = { narrative_event = { id = ACS.00008 } }
			break = yes			
		}
		if = {
			limit = {
				FROM = {
					OR = {
						has_character_flag = is_khalga
						has_character_flag = is_vee
					}					
				}
			}
			FROM = {
				move_character = ROOT					
			}
			break = yes
		}
	}
}

################################################################
## MAIN DECISION ###############################################
## ACS.00008 - Player is notified about Olaf leaves the court ##
################################################################
narrative_event = {
	id = ACS.00008
	title = ACS_00008_TITLE
	desc = ACS_00008_DESC
	picture = GFX_evt_courtiers_talking
	is_triggered_only = yes

	option = {
		name = OK
	}
}

# ACS.00009 - Create Khalga
narrative_event = {
	id = ACS.00009
	hide_window = yes
	is_triggered_only = yes

	option = {
		name = OK
		# Khalga born
		create_character = {
			name = Khalga
			age = 0
			culture = ROOT
			religion = ROOT
			trait = fair
			trait = genius
			trait = byakugan
			trait = strong
			trait = prevent_marriage
			trait = khalga_blood
		}
		new_character = {
			set_mother = ROOT
			set_character_flag = is_khalga
			set_character_flag = society_join_block
			set_character_flag = originated_from_chinese_court # to prevent to go to China
			set_character_flag = wolf_blood_first_generation
			add_character_modifier = {
				name = wolf_child
				duration = -1
			}
			dynasty = 300000
			health = 20
		}
		liege = { # Player is notified
			narrative_event = { id = ACS.00010 days = 1 }          
		}
	}
}

# ACS.00010 - Player is notified about Khalga
narrative_event = {
	id = ACS.00010
	title = ACS_00009_TITLE
	desc = ACS_00009_DESC
	picture = GFX_evt_birth
	is_triggered_only = yes

	option = {
		name = OK		
		narrative_event = { id = ACS.00011 days = 15 }		
	}
}

# ACS.00011 - Khalga flies to a foreign court
narrative_event = {
	id = ACS.00011
	title = ACS_00010_TITLE
	desc = ACS_00010_DESC
	picture = GFX_evt_machines_of_war
	is_triggered_only = yes

	immediate = {
		random_vassal = {
			limit = { is_landed = yes }
			death = { death_reason = death_murder_unknown }
		}
	}

	option = {
		name = ACS_00010_OPT_A
		random_courtier = {
			limit = { has_character_flag = is_khalga }
			character_event = { id = ACS.00006 }
		}
	}
}

#########################################
# ACS.00012 - TRAVELING EVENT. GENERIC ##
#########################################
character_event = {
	id = ACS.00012
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		is_ruler = no
        is_inaccessible_or_incapable_trigger = no
	}

	immediate = {
        location = {
            random_province = {
                limit = {
                    is_land = yes
                }
                holder_scope = {
                    save_event_target_as = target_holding_owner
                }
            }            
        }

        # Move to the new holding
        ROOT = {
            move_character = event_target:target_holding_owner
            religion = event_target:target_holding_owner
            culture = event_target:target_holding_owner
            # Special events for khalga migration
            if = {
                limit = {
                    has_character_flag = is_khalga
                }
                character_event = { id = ACS.00014 days = 1 } # Select a courtier for pollinate from Khalga
			    character_event = { id = ACS.00016 days = 5 } # Khalga assassinates the host
            }
        }
	}
}

###################
## KHALGA TRAVEL ##
###################
# ACS.00013 - Khalga traveling every year
character_event = {
	id = ACS.00013
	is_triggered_only = yes
	hide_window = yes
	has_character_flag = is_khalga
	min_age = 16

	immediate = {
		character_event = { id = ACS.00012 }
	}
}

# ACS.00014 - Select a courtier for pollinate from Khalga
character_event = {
	id = ACS.00014
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		location = {
			holder_scope = {
				any_courtier = {
					limit = {
						is_pregnant = no
						is_adult = yes
						is_female = yes
						is_incapable = no
						NOT = { has_character_flag = is_vee }
					}
					character_event = { id = ACS.00015 }
				}
			}
		}		
	}
}

# ACS.00015 - The target is pollinated by Khalga
character_event = {
	id = ACS.00015
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		set_character_flag = khalga_lover
		impregnate_cuckoo = FROM
	}
}

# ACS.00016 - Khalga assassinates the host
character_event = {
	id = ACS.00016
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		location = {
			holder_scope = {
				random_list = {
					10 = {
						death = { death_reason = death_murder_unknown killer = FROMFROM }
					}
					10 = {
						death = { death_reason = death_murder_unknown_beheading killer = FROMFROM }
					}
					10 = {
						death = { death_reason = death_murder_unknown_fall killer = FROMFROM }
					}
					10 = {
						death = { death_reason = death_murder_unknown_drowning killer = FROMFROM }
					}
					10 = {
						death = { death_reason = death_murder_unknown_snakes killer = FROMFROM }
					}
					10 = {
						death = { death_reason = death_murder_unknown_butchered killer = FROMFROM }
					}
					10 = {
						death = { death_reason = death_murder_unknown_arrow killer = FROMFROM }
					}
					5 = {
						death = { death_reason = death_murder_unknown_strangle killer = FROMFROM }
					}
					5 = {
						death = { death_reason = death_murder_unknown_fear killer = FROMFROM }
					}
					5 = {
						death = { death_reason = death_murder_unknown_lightning killer = FROMFROM }
					}
					5 = {
						death = { death_reason = death_murder_unknown_combustion killer = FROMFROM }
					}
					5 = {
						death = { death_reason = death_murder_unknown_crows killer = FROMFROM }
					}
					5 = {
						death = { death_reason = death_murder_unknown_possessed_fall killer = FROMFROM }
					}
				}
			}
		}
	}
}

#########################
## KHALGA RESURRECTION ##
#########################
# ACS.00017 - Select a character to resurrect Khalga if he dies
character_event = {
	id = ACS.00017
	hide_window = yes
	is_triggered_only = yes
	has_character_flag = is_khalga

	immediate = {
		random_playable_ruler = {
			limit = {
				adventurer = no
				is_landed = yes 
				is_married = yes 
				age = 18
				is_female = no
			}
			character_event = { id = ACS.00018 }
		}
	}
}

# ACS.00018 - The character's wife is the new mother of Khalga
character_event = {
	id = ACS.00018
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		random_spouse  = {
			character_event = { id = ACS.00019 }            
		}        
	}
}

# ACS.00019 - Spawn a new instance of Khalga
character_event = {
	id = ACS.00019
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		create_character = {
			age = 0
			culture = FROM
			religion = FROM
			trait = fair
			trait = genius
			trait = byakugan
			trait = khalga_blood
			trait = strong
			trait = prevent_marriage
		}
		new_character = {
			set_mother = ROOT           
			set_character_flag = is_khalga
			set_character_flag = society_join_block
			set_character_flag = originated_from_chinese_court # to prevent to go to China
			set_character_flag = wolf_blood_first_generation
			add_character_modifier = {
				name = wolf_child
				duration = -1
			}
			# Khalga takes the essence, so kill the mother
			mother = {
				death = { death_reason = death_childbirth }              
			}
		}
	}
}

# ACS.00020 - Ensure the correct portrait for Khalga
character_event = {
	id = ACS.00020
	is_triggered_only = yes
	hide_window = yes
	has_character_flag = is_khalga

	immediate = {
		character_event = { id = ACS.00021 days = 3 }
	}
}

# ACS.00021 - Add the khalga trait few days after adulthood
character_event = {
	id = ACS.00021
	is_triggered_only = yes
	hide_window = yes
	has_character_flag = is_khalga

	immediate = {
		add_trait = khalga_trait
	}
}

##########################
## VEE LIFECYCLE EVENTS ##
##########################
# ACS.00025 - Vee migrates to another body
character_event = {
	id = ACS.00025
	hide_window = yes
	is_triggered_only = yes
	has_character_flag = is_vee

	immediate = {
		# Check if Vee has enough maidens - Recruit maidens between the vassal's daughters
		ROOT = {
			if = {
				limit = {
					liege = {
						any_courtier = {
							has_minor_title = title_maid_of_honor
							count < 7
						}
					}
				}
				liege = {
					save_event_target_as = vee_liege
					any_vassal = {
						limit = {
							num_of_children >= 1
							any_child = {
								is_female = yes
								is_married = no
								is_adult = no
								is_inaccessible_or_incapable_trigger = no
							}
						}
						random_child = {
							limit = {
								is_female = yes
								is_married = no
								is_adult = no
								is_inaccessible_or_incapable_trigger = no
							}
							save_event_target_as = maiden_child
							move_character = event_target:vee_liege
							give_minor_title = title_maid_of_honor
							opinion = {
								modifier = opinion_loyal_servant
								who = ROOT
							}
						}
					}
					character_event = { id = ACS.00035 }
					# TO-DO : Child parents receives notification		
				}
			}
		}

		ROOT = {
			if = {
				limit = {
					age >= 33
				}
				random_list = {
					90 = {}
					10 = {
						modifier = {
							factor = 1.5
							age >= 35
						}
						modifier = {
							factor = 1.5
							age >= 37
						}
						modifier = {
							factor = 1.5
							age >= 39
						}
						modifier = {
							factor = 1.5
							age >= 41
						}
						modifier = {
							factor = 1.5
							age >= 43
						}
						death = { death_reason = death_poor_health }
						pentaghast_society = {
							any_society_member = { letter_event = { id = ACS.00028 } }
						}
					}
				}
			}
		}
	}
}

# ACS.00028 - Send a letter to Pentaghast members notifying transfer essence
letter_event = {
	id = ACS.00028
	title = ACS_00028_TITLE
	desc = ACS_00028_DESC
	is_triggered_only = yes

	option = {
		name = OK
		ai_chance = { factor = 100 }    
	}
}

##############################################
# ACS.00029 - Dojutsu inheritance mechanics ##
##############################################
character_event = {
	id = ACS.00029
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		OR = {
			true_father_even_if_dead = {
				trait = khalga_blood
			}
			mother_even_if_dead = {
				trait = vee_blood
			}
		}
	}

	immediate = {
		# BYAKUGAN INHERITANCE
		if = {
			limit = {
				true_father_even_if_dead = {
					trait = khalga_blood
				}
			}
			add_trait = khalga_blood
			random_list = {
				7 = { add_trait = byakugan }
				93 = { }
			}			
		}

		# SHARINGAN INHERITANCE
		if = {
			limit = {
				mother_even_if_dead = {
					trait = vee_blood
				}
			}
			add_trait = vee_blood
			random_list = {
				7 = { add_trait = sharingan }
				93 = { }
			}
		}

		# Checks if mather and father has different dojutsu
		if = {
			limit = {
				OR = {
					AND = {
						true_father_even_if_dead = {
							has_sharingan_family_dojutsu = yes
						}
						mother_even_if_dead = {
							has_byakugan_family_dojutsu = yes
						}
					}
					AND = {
						true_father_even_if_dead = {
							has_byakugan_family_dojutsu = yes
						}
						mother_even_if_dead = {
							has_sharingan_family_dojutsu = yes
						}
					}
				}
			}
			set_character_flag = f_sha_m_bya
			character_event = { id = ACS.00030 }
		}
	}
}

# ACS.00030 - RH child gets some problems
character_event = {
	id = ACS.00030
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				mother = { has_character_flag = dojutsu_rh }
			}
			random_list = {
				90 = { # 90 % of children will die
					death = { death_reason = death_poor_health }
				}
				10 = {
					random_list = {
						999 = {
							add_trait = malnourished
							random_list = {
								100 = { add_trait = depressed }
								100 = { add_trait = incapable }
								100 = { add_trait = infirm }
								100 = { add_trait = lunatic }
								100 = { add_trait = maimed }
								100 = { add_trait = scarred_high }
								100 = { add_trait = wounded }
								100 = { add_trait = blinded }
							}
							random_list = {
								100 = { add_trait = clubfooted }
								100 = { add_trait = dwarf }
								100 = { add_trait = harelip }
								100 = { add_trait = hunchback }
								100 = { add_trait = imbecile }
								100 = { add_trait = inbred }
								100 = { add_trait = lisp }
								100 = { add_trait = slow }
								100 = { add_trait = stutter }
								100 = { add_trait = weak }
							}
						}
						1 = {
							add_trait = rinnegan
							add_trait = genius
							add_trait = fair
						}
					}
				}
			}
		}
		else = {
			mother = { set_character_flag = dojutsu_rh }
		}
	}
}

# ACS.00031 - Vee eliminates competence
character_event = {
	id = ACS.00031
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		host = {
			any_spouse = {
				limit = {
					NOT = { has_character_flag = is_vee }
				}
				death = { death_reason = death_murder_unknown killer = FROM }
			}
			any_lover = {
				limit = {
					NOT = { has_character_flag = is_vee }
				}
				death = { death_reason = death_murder_unknown killer = FROM }
			}
			character_event = { id = ACS.00032 }
		}
	}
}

# ACS.00034 - Resurrect Vee if she dies
character_event = {
	id = ACS.00034
	hide_window = yes
	is_triggered_only = yes
	has_character_flag = is_vee

	immediate = {
		pentaghast_society = {
			random_society_member = {
				limit = {
					is_society_grandmaster = yes
				}
				save_event_target_as = pentaghast_leader
				create_character = {
					female = yes
					culture = event_target:pentaghast_leader
					religion = event_target:pentaghast_leader
					age = 0
					trait = syrena
					trait = fair
					trait = sharingan
					trait = genius
					trait = brooding
					trait = playful
					trait = fussy
					trait = strong
					trait = groomed
					trait = vee_blood
					trait = prevent_marriage
					dynasty = event_target:pentaghast_leader
				}
				new_character = {
					set_character_flag = is_vee
					set_father = event_target:pentaghast_leader
				}
			}
		}
	}
}

# ACS.00035 - Host is notified about the new Vee honor maiden
character_event = {
	id = ACS.00035
	picture = GFX_evt_courtiers_talking
	desc = ACS_00035_DESC
	is_triggered_only = yes
	ai = no

	option = {
		name = OK
	}
}

# ACS.00036 - Select Vee in adulthood. Tournament
character_event = {
	id = ACS.00036
	picture = GFX_evt_courtiers_talking
	desc = ACS_00035_DESC
	is_triggered_only = yes
	hide_window = yes
	has_character_flag = is_vee

	trigger = {
		NOT = { has_character_flag = married_in_tournament }
	}

	immediate = {
		character_event = { id = ACS.00038 days = 60 } # Tournament start
		any_playable_ruler = { # Select suitable rulers for the tournament
			limit = {
				is_landed = yes
				can_marry = yes
				age = 16
				NOT = { age = 50 }
				is_inaccessible_or_incapable_trigger = no
				is_female = no
				NOT = { has_character_flag = attending_tournament }
				NOT = { has_character_flag = do_not_disturb }
				NOT = { trait = celibate }
				NOT = { trait = eunuch }
			}
			character_event = { id = ACS.00037 } # Characters receives letter
		}
		any_character = {
			limit = {
				is_heir = yes
				can_marry = yes
				age = 16
				NOT = { age = 50 }
				is_inaccessible_or_incapable_trigger = no
				is_female = no
				NOT = { has_character_flag = attending_tournament }
				NOT = { has_character_flag = do_not_disturb }
				NOT = { trait = celibate }
				NOT = { trait = eunuch }
			}
			narrative_event = { id = ACS.00037 } # Characters receives letterl
		}
	}
}

# ACS.00037 - Characters receives letter
narrative_event = {
	id = ACS.00037
	title = "TOURNAMENTTITLE"
	desc = "ACS_00037_DESC"
	picture = "GFX_evt_vee_tournament_invitation"
	is_triggered_only = yes

	trigger = { is_inaccessible_or_incapable_trigger = no }

	option = {
		name = "EVTOPTA70000"
		ai_chance = {
			factor = 100
			modifier  = {
				factor = 0.001
				ai = yes
				is_inaccessible_or_incapable_trigger = yes
			}
		}
		prestige = 100
		set_character_flag = attending_tournament
		set_character_flag = do_not_disturb
		set_character_flag = attending_vee_tournament
		hidden_tooltip = { character_event = { id = 70999 days = 300 } } # Safety catch flag clearing
	}
	option = {
		name = "EVTOPTB70000"
		ai_chance = {
			factor = 0.1
		}
	}
}

# ACS.00038 - Tournament start
character_event = {
	id = ACS.00038
	is_triggered_only = yes
	hide_window = yes

	option = {
		name = "EVTOPTA70001"
		
		trigger = {}
		
		hidden_tooltip = {
			# Injuries
			any_playable_ruler = {
				limit = {
					has_character_flag = attending_vee_tournament
				}
				character_event = { id = 70050 days = 1 random = 15 }
				#Set score
				character_event = { id = 70060 days = 46 }
			}
			# Select winner
			character_event = { id = ACS.00039 days = 50 } # Original : 70061
			# Notify winner
			narrative_event = { id = ACS.00040 days = 52 } # Marry with Vee
		}
	}
}

# ACS.00039 - Select the winner
character_event = {
	id = ACS.00039
	hide_window = yes	
	is_triggered_only = yes
	
	immediate = {
		random_character = {
			limit = {
				has_character_flag = tourney_score_15
				has_character_flag = attending_vee_tournament
			}
			clr_character_flag = tourney_score_15
			set_character_flag = tournament_vee_winner
			break = yes
		}
		random_character = {
			limit = {
				has_character_flag = tourney_score_14
				has_character_flag = attending_vee_tournament
			}
			clr_character_flag = tourney_score_14
			set_character_flag = tournament_vee_winner
			break = yes
		}
		random_character = {
			limit = {
				has_character_flag = tourney_score_13
				has_character_flag = attending_vee_tournament
			}
			clr_character_flag = tourney_score_13
			set_character_flag = tournament_vee_winner
			break = yes
		}
		random_character = {
			limit = {
				has_character_flag = tourney_score_12
				has_character_flag = attending_vee_tournament
			}
			clr_character_flag = tourney_score_12
			set_character_flag = tournament_vee_winner
			break = yes
		}
		random_character = {
			limit = {
				has_character_flag = tourney_score_11
				has_character_flag = attending_vee_tournament
			}
			clr_character_flag = tourney_score_11
			set_character_flag = tournament_vee_winner
			break = yes
		}
		random_character = {
			limit = {
				has_character_flag = tourney_score_10
				has_character_flag = attending_vee_tournament
			}
			clr_character_flag = tourney_score_10
			set_character_flag = tournament_vee_winner
			break = yes
		}
		random_character = {
			limit = {
				has_character_flag = tourney_score_09
				has_character_flag = attending_vee_tournament
			}
			clr_character_flag = tourney_score_09
			set_character_flag = tournament_vee_winner
			break = yes
		}
		random_character = {
			limit = {
				has_character_flag = tourney_score_08
				has_character_flag = attending_vee_tournament
			}
			clr_character_flag = tourney_score_08
			set_character_flag = tournament_vee_winner
			break = yes
		}
		random_character = {
			limit = {
				has_character_flag = tourney_score_07
				has_character_flag = attending_vee_tournament
			}
			clr_character_flag = tourney_score_07
			set_character_flag = tournament_vee_winner
			break = yes
		}
		random_character = {
			limit = {
				has_character_flag = tourney_score_06
				has_character_flag = attending_vee_tournament
			}
			clr_character_flag = tourney_score_06
			set_character_flag = tournament_vee_winner
			break = yes
		}
		random_character = {
			limit = {
				has_character_flag = tourney_score_05
				has_character_flag = attending_vee_tournament
			}
			clr_character_flag = tourney_score_05
			set_character_flag = tournament_vee_winner
			break = yes
		}
		random_character = {
			limit = {
				has_character_flag = tourney_score_04
				has_character_flag = attending_vee_tournament
			}
			clr_character_flag = tourney_score_04
			set_character_flag = tournament_vee_winner
			break = yes
		}
		random_character = {
			limit = {
				has_character_flag = tourney_score_03
				has_character_flag = attending_vee_tournament
			}
			clr_character_flag = tourney_score_03
			set_character_flag = tournament_vee_winner
			break = yes
		}
		random_character = {
			limit = {
				has_character_flag = tourney_score_02
				has_character_flag = attending_vee_tournament
			}
			clr_character_flag = tourney_score_02
			set_character_flag = tournament_vee_winner
			break = yes
		}
		random_character = {
			limit = {
				has_character_flag = tourney_score_01
				has_character_flag = attending_vee_tournament
			}
			clr_character_flag = tourney_score_01
			set_character_flag = tournament_vee_winner
			break = yes
		}
		random_character = {
			limit = {
				has_character_flag = tourney_score_00
				has_character_flag = attending_vee_tournament
			}
			clr_character_flag = tourney_score_00
			set_character_flag = tournament_vee_winner
		}
	}
}

# ACS.00040 - Winner marries with vee
narrative_event = {
	id = ACS.00040
	title = "TOURNAMENTTITLE"
	desc = "ACS_00040_DESC"
	picture = "GFX_evt_vee_tournament_invitation"
	is_triggered_only = yes

	immediate = {		
		random_character = {
			limit = {
				has_character_flag = tournament_vee_winner
			}
			add_spouse = ROOT
			add_lover = ROOT
			clr_character_flag = attending_vee_tournament
			clr_character_flag = do_not_disturb
			clr_character_flag = attending_tournament
			clr_character_flag = tournament_vee_winner

			any_character = {
				limit = {
					has_character_flag = attending_vee_tournament
				}
				character_event = { id = ACS.00041 days = 3 } # Other characters receive notification
			}
		}

		# Vee effects
		remove_trait = prevent_marriage
		set_character_flag = married_in_tournament
	}

	option = {
		name = ACS_00040_OPT_A
		ai_chance = {
			factor = 100
		}
	}
}

# ACS.00041 - Other characters receive notification
character_event = {
	id = ACS.00041
	title = "TOURNAMENTTITLE"
	desc = "ACS_00041_DESC"
	picture = "GFX_evt_vee_tournament_invitation"
	is_triggered_only = yes

	immediate = {
		clr_character_flag = attending_tournament
		clr_character_flag = attending_vee_tournament
		clr_character_flag = do_not_disturb
	}

	option = {
		name = ACS_00041_OPT_A
		ai_chance = {
			factor = 100
		}
	}
}
