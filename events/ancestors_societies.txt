NAMESPACE = ACS

# ACS.00200 - Spawn some characters for Pentaghast and Sakya
character_event = {
    id = ACS.00200
    hide_window = yes
    is_triggered_only = yes

    immediate = {
        if = {
            limit = {
                has_character_flag = is_ancient_one
            }
            # Fill the tier 4 seats
            set_variable = { which = count value = 2 }
            while = {
                limit = {
                    check_variable = {
                        which = count
                        value = 1
                    }
                }
                subtract_variable = {
                    which = count
                    value = 1
                }
                create_character = {
                    random_traits = yes
                    trait = travelling
                    female = yes
                }
                new_character = {
                    join_society = sakya_society
                    society_rank_up = 3
                    set_character_flag = originated_from_chinese_court
                    character_event = { id = ACS.00201 }
                }
            }
            # Fill the tier 3 seats
            set_variable = { which = count value = 10 }
            while = {
                limit = {
                    check_variable = {
                        which = count
                        value = 1
                    }
                }
                subtract_variable = {
                    which = count
                    value = 1
                }
                create_character = {
                    random_traits = yes
                    female = no
                    trait = travelling
                }
                new_character = {
                    join_society = sakya_society
                    society_rank_up = 2
                    set_character_flag = originated_from_chinese_court
                    character_event = { id = ACS.00201 }
                }
            }
            # Fill the tier 2 seats
            set_variable = { which = count value = 20 }
            while = {
                limit = {
                    check_variable = {
                        which = count
                        value = 1
                    }
                }
                subtract_variable = {
                    which = count
                    value = 1
                }
                create_character = {
                    random_traits = yes
                    female = yes
                    trait = travelling
                }
                new_character = {
                    join_society = sakya_society
                    society_rank_up = 1
                    set_character_flag = originated_from_chinese_court
                    character_event = { id = ACS.00201 }
                }            
            }

            # Fill the tier 1 seats
            set_variable = { which = count value = 30 }
            while = {
                limit = {
                    check_variable = {
                        which = count
                        value = 1
                    }
                }
                subtract_variable = {
                    which = count
                    value = 1
                }
                create_character = {
                    random_traits = yes
                    female = no
                    trait = travelling
                }
                new_character = {
                    join_society = sakya_society
                    set_character_flag = originated_from_chinese_court
                    character_event = { id = ACS.00201 }
                }            
            }  
        }

        # Fill the Pentaghast society
        if = {
            limit = {
                has_character_flag = is_olaf
            }
            create_character = {
                name="Gunnr"
                trait = ambitious
			    trait = elusive_shadow
                trait = travelling
                trait = prevent_marriage
                female = no
                culture = FROM
                religion = FROM
            }
            new_character = {
                join_society = pentaghast_society
                society_rank_up = 3
                set_secret_religion = ishtar_religion
                set_character_flag = originated_from_chinese_court
                character_event = { id = ACS.00201 }
            }
            create_character = {
                name="Geirdriful"
                trait = ambitious
			    trait = elusive_shadow
                trait = travelling
                trait = prevent_marriage
                female = no
                culture = FROM
                religion = FROM
            }
            new_character = {
                join_society = pentaghast_society
                society_rank_up = 3
                set_secret_religion = ishtar_religion
                set_character_flag = originated_from_chinese_court
                character_event = { id = ACS.00201 }
            }
            create_character = {
                name="Eir"
                trait = ambitious
			    trait = elusive_shadow
                trait = travelling
                trait = prevent_marriage
                female = no
                culture = FROM
                religion = FROM
            }
            new_character = {
                join_society = pentaghast_society
                society_rank_up = 3
                set_secret_religion = ishtar_religion
                set_character_flag = originated_from_chinese_court
                character_event = { id = ACS.00201 }
            }
            create_character = {
                name="Kara"
                trait = ambitious
			    trait = elusive_shadow
                trait = travelling
                trait = prevent_marriage
                female = no
                culture = FROM
                religion = FROM
            }
            new_character = {
                join_society = pentaghast_society
                society_rank_up = 3
                set_secret_religion = ishtar_religion
                set_character_flag = originated_from_chinese_court
                character_event = { id = ACS.00201 }
            }
            create_character = {
                name="Rota"
                trait = ambitious
			    trait = elusive_shadow
                trait = travelling
                trait = prevent_marriage
                female = no
                culture = FROM
                religion = FROM
            }
            new_character = {
                join_society = pentaghast_society
                society_rank_up = 3
                set_secret_religion = ishtar_religion
                set_character_flag = originated_from_chinese_court
                character_event = { id = ACS.00201 }
            }
            create_character = {
                name="Olrun"
                trait = ambitious
			    trait = elusive_shadow
                trait = travelling
                trait = prevent_marriage
                female = no
                culture = FROM
                religion = FROM
            }
            new_character = {
                join_society = pentaghast_society
                society_rank_up = 3
                set_secret_religion = ishtar_religion
                set_character_flag = originated_from_chinese_court
                character_event = { id = ACS.00201 }
            }
            create_character = {
                name="Gondul"
                trait = ambitious
			    trait = elusive_shadow
                trait = travelling
                trait = prevent_marriage
                female = no
                culture = FROM
                religion = FROM
            }
            new_character = {
                join_society = pentaghast_society
                society_rank_up = 3
                set_secret_religion = ishtar_religion
                set_character_flag = originated_from_chinese_court
                character_event = { id = ACS.00201 }
            }
            create_character = {
                name="Hildr"
                trait = ambitious
			    trait = elusive_shadow
                trait = travelling
                trait = prevent_marriage
                female = no
                culture = FROM
                religion = FROM
            }
            new_character = {
                join_society = pentaghast_society
                society_rank_up = 3
                set_secret_religion = ishtar_religion
                set_character_flag = originated_from_chinese_court
                character_event = { id = ACS.00201 }
            }
            create_character = {
                name="Sigrun"
                trait = ambitious
			    trait = elusive_shadow
                trait = travelling
                trait = prevent_marriage
                female = yes
                culture = FROM
                religion = FROM
            }
            new_character = {
                join_society = pentaghast_society
                society_rank_up = 3
                set_secret_religion = ishtar_religion
                set_character_flag = originated_from_chinese_court
                character_event = { id = ACS.00201 }
            }
        }        
    }
}

#########################################
# ACS.00201 - TRAVELING EVENT. GENERIC ##
#########################################
character_event = {
	id = ACS.00201
	is_triggered_only = yes
	hide_window = yes
	is_in_society = yes

	trigger = {
        OR = {
            society_member_of = pentaghast_society
            society_member_of = sakya_society
        }		
		is_landed = no
		prisoner = no
		is_incapable = no
        NOT = { has_character_flag = is_vee }
        NOT = { has_character_flag = is_senua }
	}

	immediate = {
        location = {
            random_province = {
                limit = {
                    is_land = yes
                    num_of_settlements >= 2
                }
                random_province_holding = {
                    limit = {
                        is_capital = no
                    }
                    holder_scope = {
                        save_event_target_as = target_holding_owner
                    }
                }
            }
        }
        ROOT = {
            move_character = event_target:target_holding_owner
            if = {
                limit = {
                    society_member_of = pentaghast_society
                    society_rank == 3
                    is_landed = no
                    prisoner = no
                    is_incapable = no
                }
                # character_event = { id = ACS.00202 }
            }
            if = {
                limit = {
                    has_character_flag = is_khalga
                }
                character_event = { id = ACS.00017 days = 1 }
			    character_event = { id = ACS.00019 days = 5 }
            }
        }
	}	
}

# ACS.00202 - Pentaghast causes civil unrest
character_event = {
	id = ACS.00202
	is_triggered_only = yes
	hide_window = yes
	is_in_society = yes

	immediate = {
		location = {
			random_neighbor_province = {
				add_province_modifier = { name = visited_by_pentaghast days = 66 }
			}
		}
	}	
}

#################################
## SOCIETIES RECRUITMENT EVENT ##
#################################
# ACS.00203 - Trigger for a character interested in society
character_event = {
	id = ACS.00203
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		is_in_society = no
		OR = {
			interested_in_society = pentaghast_society
			interested_in_society = sakya_society
		}
	}

	immediate = {
		character_event = { id = ACS.00204 days = 30 random = 15 }
	}
}

#ACS.00204 - Select recruter
character_event = {
	id = ACS.00204
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		is_in_society = no
		OR = {
			interested_in_society = pentaghast_society
			interested_in_society = sakya_society
		}
	}

	immediate = {
		if = {
			limit = { prisoner = yes }
			repeat_event = { id = ACS.00204 days = 90 random = 640 }
			break = yes
		}
		#SAKYA
		if = {
			limit = {
				interested_in_society = sakya_society
				NOT = { has_character_flag = being_recruited_by_sakya }
			}

			random_society_member = {
				limit = {
					society_member_of = sakya_society
					is_society_grandmaster = no
				}
				save_event_target_as = sakya_recruiter
				character_event = { id = ACS.00205 }
			}
		}
		#PENTAGHAST
		if = {
			limit = {
				interested_in_society = pentaghast_society
				NOT = { has_character_flag = being_recruited_by_pentaghast }
			}
			random_society_member = {
				limit = {
					society_member_of = pentaghast_society
					is_society_grandmaster = no
				}
				save_event_target_as = pentagast_recruiter
                character_event = { id = ACS.00205 }
			}
		}
	}	
}

# ACS.00205 Setting up the flags for posible candidate
character_event = {
	id = ACS.00205
	hide_window = yes

	is_triggered_only = yes

	immediate = {
        if = {
            limit = {
                society_member_of = sakya_society
            }
            FROM = {
                set_character_flag = being_recruited_by_sakya
                # character_event = { id = ACS.00205 } # id = MNM.7001
            }
            break = yes
        }
        if = {
            limit = {
                society_member_of = pentaghast_society
            }
            FROM = {
                set_character_flag = being_recruited_by_pentaghast
                character_event = { id = ACS.00206 } # id = MNM.7001
            }
            break = yes
        }	
	}
}

# ACS.00206 - Pentaghast member talks with the candidate
character_event = {
	id = ACS.00206
	desc = ACS_00205_DESC

	picture = GFX_evt_shady_meeting
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes
	prisoner = no

	option = {
		name = ACS_00205_OPT_A
		custom_tooltip = { text = ACS_00205_OPT_A_TT }

		reverse_opinion = {
			who = event_target:pentaghast_recruiter
			modifier = opinion_agreed_with_opinion
			years = 5
		}

		hidden_effect = {
            character_event = { id = ACS.00207 } # MNM.6999
		}		
	}

	#Disapproving of heretics
	option = {
		name = {
			text = ACS_00205_OPT_B
		}
		
		custom_tooltip = { text = ACS_00205_OPT_B_TT }

		reverse_opinion = {
			who = event_target:pentaghast_recruiter
			modifier = opinion_disagreed_with_opinion
			years = 5
		}

		clr_character_flag = being_recruited_by_pentaghast
	}
}

# ACS.00207 For the recruit: Recruiter contiunes offering more radical ideas, gives strange idol
character_event = {
	id = ACS.00207
	desc = ACS_00206_DESC
	picture = GFX_evt_shady_meeting
	border = GFX_event_normal_frame_intrigue
	is_triggered_only = yes

    option = {
        name = OK

        reverse_opinion = {
			who = event_target:pentaghast_recruiter
			modifier = opinion_open_minded
			years = 5
		}
		set_character_flag = willing_to_join

        hidden_effect = {
            #character_event = { id = ACS.00208 days = 30 random = 45 }
        }
    }
}

# ACS.00208 Force join AI characters to societies
character_event = {
	id = ACS.00208
	hide_window = yes
	is_triggered_only = yes

    is_in_society = yes

    trigger = {
        OR = {
            society_member_of = pentaghast_society
            society_member_of = sakya_society
        }
    }
	
	immediate = {
		if = {
			limit = {
				ai = yes
				prisoner = no
				NOT = { trait = incapable }
				is_in_society = yes
				society_rank < 3
				society_can_rank_up = yes
			}
			random_list = {
				80 = {}
				20 = {
					society_rank_up = 1					
				}
			}
		}

		# Select candidates on main location
		location = {
			holder_scope = {
				any_courtier = {
					limit = {
						ai = yes
						prisoner = no
						NOT = { trait = incapable }
						is_adult = yes
						is_in_society = no
						controls_religion = no
						block_general_event_trigger = no
						is_landed = no
					}
					character_event = { id = ACS.00209 }
				}
			}
		}
	}
}

# ACS.00209 - Join to society
character_event = {
	id = ACS.00209
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			95 = { # do nothing
			}
			5 = { # try to join a society			
				random_list = {
					700 = { } # Fall back dead weight
					500 = { 
						trigger = {
							can_join_society = pentaghast_society
						}						
						modifier = {
							factor = 2
							pentaghast_society = { num_of_society_members < 20 }
						}
						modifier = {
							factor = 2
							pentaghast_society = { num_of_society_members < 15 }
						}
						modifier = {
							factor = 2
							pentaghast_society = { num_of_society_members < 10 }
						}
						set_secret_religion = ishtar_religion

						join_society = pentaghast_society
						random_list = { # Artificially increase society influence for balance purposes
							75 = {
								modifier = {
									factor = 0
									society_influence >= 30
								}
								add_mission_succeed_influence_effect = yes
							}
							25 = {
							}
						}
						if = {
							limit = {
								NOT = {
									society = {
										any_society_member = {
											is_society_grandmaster = yes
										}
									}
								}
							}
							set_society_grandmaster = yes
						}
					}
					500 = { 
						trigger = {
							can_join_society = sakya_society
						}						
						modifier = {
							factor = 2
							sakya_society = { num_of_society_members < 20 }
						}
						modifier = {
							factor = 2
							sakya_society = { num_of_society_members < 15 }
						}
						modifier = {
							factor = 2
							sakya_society = { num_of_society_members < 10 }
						}
						join_society = sakya_society
						random_list = { # Artificially increase society influence for balance purposes
							75 = {
								modifier = {
									factor = 0
									society_influence >= 30
								}
								add_mission_succeed_influence_effect = yes
							}
							25 = {
							}
						}
						if = {
							limit = {
								NOT = {
									society = {
										any_society_member = {
											is_society_grandmaster = yes
										}
									}
								}
							}
							set_society_grandmaster = yes
						}
					}
				}
			}
		}
	}
}


